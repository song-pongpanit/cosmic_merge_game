<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Solar System Merge - ‡∏ú‡∏à‡∏ç‡∏†‡∏±‡∏¢‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏∏‡∏£‡∏¥‡∏¢‡∏∞</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyAoO3mLc6cau4GsgOXQ-KFBsaXNwg8xYcI",
      authDomain: "song-paysolutions.firebaseapp.com",
      projectId: "song-paysolutions",
      storageBucket: "song-paysolutions.firebasestorage.app",
      messagingSenderId: "602518075045",
      appId: "1:602518075045:web:b4c5a65904351d51babf4c",
      measurementId: "G-2JYVRLJ721"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const appId = typeof __app_id !== "undefined" ? __app_id : "cosmic-merge-v1";

    window.gameDb = { db, appId, auth, signInWithCustomToken, signInAnonymously, onAuthStateChanged };
  </script>

  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #050515;
      font-family: "Kanit", sans-serif;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      user-select: none; /* ‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ô‡∏•‡∏≤‡∏Å */
      -webkit-user-select: none;
    }

    #game-container {
      position: relative;
      width: 400px;
      height: 600px;
      box-shadow: 0 0 50px rgba(0, 100, 255, 0.2);
      border: 4px solid rgba(255, 255, 255, 0.05);
      border-radius: 24px;
      overflow: hidden;
      background: #050515;
      cursor: none;

      user-select: none; /* ‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≠‡∏ô‡∏•‡∏≤‡∏Å */
      -webkit-user-select: none;
      touch-action: none; /* ‚úÖ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏Å‡∏±‡∏ô scroll/zoom gesture ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
    }

    canvas { display: block; }

    .space-bg {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: radial-gradient(circle at 50% 50%, #1a1a40 0%, #050515 100%);
      z-index: 0;
    }

    .nebula {
      position: absolute;
      width: 300px; height: 300px;
      background: radial-gradient(circle, rgba(100, 50, 255, 0.15) 0%, transparent 70%);
      filter: blur(50px);
      border-radius: 50%;
      animation: drift 20s infinite alternate;
    }

    @keyframes drift {
      from { transform: translate(-20%, -20%); }
      to { transform: translate(20%, 20%); }
    }

    #ui-layer {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      padding: 20px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      z-index: 5;
      opacity: 0;
      transition: opacity 0.5s;
    }

    .score-container {
      position: absolute;
      top: 20px; left: 20px;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      padding: 12px;
      border-radius: 18px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 150px; height: 80px;
      box-sizing: border-box;
    }

    #score-label {
      font-size: 11px;
      color: #aaaaff;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 4px;
    }

    #score {
      font-size: 20px;
      font-weight: bold;
      color: #fff;
      text-shadow: 0 0 10px rgba(0, 200, 255, 0.5);
      line-height: 1;
    }

    .next-container {
      position: absolute;
      top: 20px; right: 20px;
      text-align: center;
      background: rgba(255, 255, 255, 0.05);
      padding: 12px;
      border-radius: 18px;
      width: 120px; height: 80px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      box-sizing: border-box;
    }

    #surrender-btn {
      position: absolute;
      top: 10px; left: 10px;
      pointer-events: auto;
      background: linear-gradient(135deg, #6644ff, #8844ff);
      border: none;
      color: white;
      width: 32px; height: 32px;
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s;
      z-index: 20;
      box-shadow: 0 4px 15px rgba(100, 50, 255, 0.4);
    }
    #surrender-btn:hover { transform: scale(1.1); filter: brightness(1.2); }

    #mute-btn {
      position: absolute;
      top: 10px; right: 10px;
      pointer-events: auto;
      background: linear-gradient(135deg, #6644ff, #8844ff);
      border: none;
      color: white;
      width: 32px; height: 32px;
      border-radius: 20px;
      display: none; /* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡∏Ñ‡πà‡∏≠‡∏¢‡πÇ‡∏ä‡∏ß‡πå */
      align-items: center;
      justify-content: center;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s;
      z-index: 20;
      box-shadow: 0 4px 15px rgba(100, 50, 255, 0.4);
    }
    #mute-btn:hover { transform: scale(1.1); filter: brightness(1.2); }

    .overlay-screen {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(5, 5, 20, 0.85);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100;
      padding: 30px;
      box-sizing: border-box;
      text-align: center;
      cursor: auto;
    }

    #login-screen { display: flex; background: transparent; }
    #game-over { display: none; background: rgba(5, 5, 20, 0.95); }

    .login-content {
      position: relative;
      z-index: 2;
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    input {
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(100, 100, 255, 0.4);
      padding: 14px 20px;
      border-radius: 15px;
      color: white;
      font-family: "Kanit", sans-serif;
      font-size: 16px;
      margin: 25px 0;
      width: 85%;
      outline: none;
      transition: all 0.3s;
      text-align: center;
    }

    input:focus {
      border-color: #8888ff;
      background: rgba(255, 255, 255, 0.15);
      box-shadow: 0 0 15px rgba(100, 100, 255, 0.2);
    }

    .leaderboard {
      width: 100%;
      margin: 15px 0;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 15px;
      padding: 15px;
      font-size: 12px;
      max-height: 250px;
      overflow-y: auto;
    }

    .leaderboard-item {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .item-me { color: #ffff00; font-weight: bold; }

    .your-result {
      margin: 10px 0;
      padding: 10px;
      background: rgba(85, 85, 255, 0.2);
      border-radius: 10px;
      width: 100%;
    }

    button.primary-btn {
      background: linear-gradient(135deg, #4444ff, #8844ff);
      border: none;
      color: white;
      padding: 16px 45px;
      border-radius: 30px;
      cursor: pointer;
      font-weight: bold;
      font-size: 18px;
      transition: all 0.3s;
      box-shadow: 0 4px 20px rgba(80, 80, 255, 0.4);
    }

    button.primary-btn:hover {
      transform: translateY(-3px) scale(1.05);
      filter: brightness(1.2);
      box-shadow: 0 8px 25px rgba(80, 80, 255, 0.5);
    }

    .guide-line {
      position: absolute;
      top: 0;
      width: 1px;
      height: 100%;
      background: linear-gradient(to bottom, rgba(100, 150, 255, 0.4), transparent);
      pointer-events: none;
      z-index: 1;
      display: none;
    }

    #current-planet-name {
      position: absolute;
      top: 120px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 14px;
      color: rgba(255, 255, 255, 0.5);
      pointer-events: none;
    }

    /* ‚≠ê Star Cursor (Twinkle) */
    #star-cursor{
      position:absolute;
      left:0; top:0;
      pointer-events:none;
      z-index:60; /* ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ canvas/UI */
      transform: translate(-9999px, -9999px);
      opacity:0;
      transition: opacity 120ms ease;
    }
    #star-cursor.hidden{ opacity:0 !important; }

    #star-cursor .spark{
      width:6px;
      height:6px;
      border-radius:50%;
      background: rgba(255,255,255,0.95);
      box-shadow:
        0 0 6px rgba(255,255,255,0.9),
        0 0 14px rgba(120,170,255,0.45),
        0 0 26px rgba(160,100,255,0.25);
      filter: blur(0.2px);
      animation: twinkle 1.2s infinite ease-in-out;
      will-change: transform, filter;
    }

    #star-cursor .spark::after{
      content:"";
      position:absolute;
      inset:-10px;
      border-radius:50%;
      background: radial-gradient(circle,
        rgba(255,255,255,0.18),
        rgba(120,170,255,0.08),
        transparent 65%);
      filter: blur(2px);
    }

    @keyframes twinkle{
      0%   { transform: scale(0.9); filter: brightness(0.9); }
      50%  { transform: scale(1.25); filter: brightness(1.35); }
      100% { transform: scale(0.9); filter: brightness(0.9); }
    }
  </style>

  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;600&display=swap" rel="stylesheet" />
</head>

<body>
  <div id="game-container">
    <div id="login-screen" class="overlay-screen">
      <div class="space-bg" id="login-space-bg">
        <div class="nebula" style="top: 10%; left: 10%;"></div>
        <div class="nebula" style="bottom: 10%; right: 10%; background: radial-gradient(circle, rgba(255, 50, 150, 0.1) 0%, transparent 70%);"></div>
      </div>

      <div class="login-content">
        <h1 style="color: #fff; font-size: 36px; margin-bottom: 0; text-shadow: 0 0 20px rgba(100, 100, 255, 0.8);">Solar System</h1>
        <h2 style="color: #8888ff; font-size: 18px; margin-top: 0; font-weight: 300; letter-spacing: 4px; text-transform: uppercase;">Merge Adventure</h2>

        <div style="width: 60px; height: 2px; background: linear-gradient(90deg, transparent, #8888ff, transparent); margin: 20px 0;"></div>

        <p style="font-size: 14px; color: #aaaaff; margin-bottom: 0;">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏ô‡∏±‡∏Å‡∏™‡∏≥‡∏£‡∏ß‡∏à</p>
        <input type="text" id="player-name-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..." maxlength="12" />
        <button id="start-btn" class="primary-btn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</button>

        <p style="font-size: 11px; color: rgba(255, 255, 255, 0.3); margin-top: 40px;">‡∏£‡∏ß‡∏°‡∏î‡∏ß‡∏á‡∏î‡∏≤‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏ß‡∏≤‡∏•</p>
      </div>
    </div>

    <button id="surrender-btn" title="‡∏¢‡∏≠‡∏°‡πÅ‡∏û‡πâ" onclick="triggerGameOver()" style="display: none;">‚öê</button>
    <button id="mute-btn" title="‡∏õ‡∏¥‡∏î/‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á">üîä</button>

    <div id="guide" class="guide-line"></div>
    <div id="current-planet-name"></div>

    <div id="ui-layer">
      <div class="score-container">
        <span id="score-label">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°</span>
        <div id="score">0</div>
      </div>

      <div class="next-container">
        <div style="font-size: 11px; color: #aaaaff; margin-bottom: 4px;">‡∏î‡∏ß‡∏á‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</div>
        <canvas id="next-canvas" width="100" height="100" style="width: 50px; height: 50px;"></canvas>
      </div>
    </div>

    <div id="game-over" class="overlay-screen">
      <h2 style="margin: 0; color: #ff5555; font-size: 24px;">‡∏†‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</h2>
      <div class="leaderboard" id="leaderboard-list">
        <div style="text-align: center; padding: 10px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö...</div>
      </div>

      <div class="your-result">
        <span style="font-size: 12px; color: #aaaaff;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠‡∏á <span id="display-my-name" style="color: #fff;"></span>:</span>
        <div id="final-score" style="font-size: 24px; font-weight: bold; color: #fff;">0</div>
      </div>

      <button class="primary-btn" onclick="location.reload()">‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    </div>

    <!-- ‚≠ê Star Cursor -->
    <div id="star-cursor"><div class="spark"></div></div>

    <audio id="sfx-drop" src="drop.mp3" preload="auto"></audio>
    <audio id="sfx-merge" src="merge.mp3" preload="auto"></audio>
    <audio id="sfx-gameover" src="gameover.mp3" preload="auto"></audio>
    <audio id="bgm" src="bgm.mp3" preload="auto" loop></audio>
  </div>

  <script type="module">
    import { collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    window.saveScoreToCloud = async (scoreVal, nameVal) => {
      const { db, appId, auth } = window.gameDb;
      if (!auth.currentUser) return;
      try {
        await addDoc(collection(db, "artifacts", appId, "public", "data", "scores"), {
          uid: auth.currentUser.uid,
          name: nameVal,
          score: scoreVal,
          timestamp: Date.now()
        });
      } catch (e) {
        console.error("Firestore Save Error:", e);
      }
    };

    window.listenToLeaderboard = () => {
      const { db, appId } = window.gameDb;
      const q = collection(db, "artifacts", appId, "public", "data", "scores");

      onSnapshot(
        q,
        (snapshot) => {
          let allScores = [];
          snapshot.forEach((doc) => allScores.push(doc.data()));
          allScores.sort((a, b) => b.score - a.score);
          const topScores = allScores.slice(0, 10);

          const list = document.getElementById("leaderboard-list");
          list.innerHTML =
            '<div style="text-align: center; color: #aaaaff; margin-bottom: 8px; font-weight: bold; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 5px;">‡∏ó‡∏≥‡πÄ‡∏ô‡∏µ‡∏¢‡∏ö TOP 10 ‡∏ô‡∏±‡∏Å‡∏™‡∏≥‡∏£‡∏ß‡∏à</div>';

          if (topScores.length === 0) {
            list.innerHTML += '<div style="text-align:center; padding:10px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö</div>';
            return;
          }

          topScores.forEach((s, i) => {
            const item = document.createElement("div");
            item.className = "leaderboard-item";
            const isMe = s.uid === window.gameDb.auth.currentUser?.uid;
            if (isMe) item.classList.add("item-me");
            item.innerHTML = `<span>${i + 1}. ${s.name || "Unknown"}</span> <span>${s.score}</span>`;
            list.appendChild(item);
          });
        },
        (err) => {
          console.error("Leaderboard Snapshot Error:", err);
        }
      );
    };
  </script>

  <script>
    let isMuted = false;

    function playSfx(id, volume = 0.8) {
      if (isMuted) return;
      const a = document.getElementById(id);
      if (!a) return;
      a.volume = volume;
      a.currentTime = 0;
      a.play().catch(() => {});
    }

    function startBgm(volume = 0.35) {
      if (isMuted) return;
      const bgm = document.getElementById("bgm");
      if (!bgm) return;
      bgm.volume = volume;
      bgm.play().catch(() => {});
    }

    function stopBgm() {
      const bgm = document.getElementById("bgm");
      if (bgm) bgm.pause();
    }

    function setMute(nextMuted) {
      isMuted = nextMuted;
      const btn = document.getElementById("mute-btn");
      if (btn) btn.textContent = isMuted ? "üîá" : "üîä";
      if (isMuted) stopBgm();
      else startBgm(0.35);
    }

    /* =====================
       ‚≠ê STAR CURSOR (Twinkle)
    ====================== */
    const starCursor = document.getElementById('star-cursor');
    let cursorX = -9999, cursorY = -9999;
    let targetX = -9999, targetY = -9999;
    let cursorRaf = null;

    function showStarCursor(){
      if (!starCursor) return;
      starCursor.classList.remove('hidden');
      starCursor.style.opacity = '1';
    }

    function hideStarCursor(){
      if (!starCursor) return;
      starCursor.classList.add('hidden');
      starCursor.style.opacity = '0';
    }

    function animateStarCursor(){
      cursorX += (targetX - cursorX) * 0.25;
      cursorY += (targetY - cursorY) * 0.25;
      starCursor.style.transform = `translate(${cursorX}px, ${cursorY}px) translate(-50%, -50%)`;
      cursorRaf = requestAnimationFrame(animateStarCursor);
    }

    const PLANETS = [
      { name: "‡∏î‡∏ß‡∏á‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå", radius: 16, color: "#d1d1d1", score: 2, detail: "crater", personality: "sleeping" },
      { name: "‡∏î‡∏≤‡∏ß‡∏û‡∏∏‡∏ò", radius: 24, color: "#b5a8a2", score: 4, detail: "crater", personality: "shy" },
      { name: "‡∏î‡∏≤‡∏ß‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£", radius: 34, color: "#e27b58", score: 8, detail: "spots", personality: "angry" },
      { name: "‡∏î‡∏≤‡∏ß‡∏®‡∏∏‡∏Å‡∏£‡πå", radius: 44, color: "#e3bb76", score: 16, detail: "clouds", personality: "happy" },
      { name: "‡πÇ‡∏•‡∏Å", radius: 56, color: "#4b92db", score: 32, detail: "earth", personality: "cool" },
      { name: "‡∏î‡∏≤‡∏ß‡πÄ‡∏ô‡∏õ‡∏à‡∏π‡∏ô", radius: 72, color: "#3e54e8", score: 64, detail: "storm", personality: "dizzy" },
      { name: "‡∏î‡∏≤‡∏ß‡∏¢‡∏π‡πÄ‡∏£‡∏ô‡∏±‡∏™", radius: 88, color: "#b8e3e4", score: 128, detail: "ring_vertical", personality: "nerd" },
      { name: "‡∏î‡∏≤‡∏ß‡πÄ‡∏™‡∏≤‡∏£‡πå", radius: 105, color: "#ead6b8", score: 256, detail: "ring", personality: "fancy" },
      { name: "‡∏î‡∏≤‡∏ß‡∏û‡∏§‡∏´‡∏±‡∏™", radius: 125, color: "#d39c7e", score: 512, detail: "jupiter", personality: "king" },
      { name: "‡∏î‡∏ß‡∏á‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå", radius: 145, color: "#ffcc33", score: 1024, detail: "sun", personality: "blush" }
    ];

    const GAME_WIDTH = 400;
    const GAME_HEIGHT = 600;

    let engine,
      render,
      runner,
      currentPlanet = null,
      nextPlanetIndex = 0,
      score = 0,
      isGameOver = false,
      canDrop = true,
      stars = [],
      playerName = "Unknown Explorer",
      lastMouseX = 200;

    // ‚úÖ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏•‡πá‡∏á" (‡∏Å‡∏î‡∏Ñ‡πâ‡∏≤‡∏á/‡πÅ‡∏ï‡∏∞‡∏Ñ‡πâ‡∏≤‡∏á)
    let isAiming = false;

    async function initFirebaseLocal() {
      const { auth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } = window.gameDb;
      const token = typeof __initial_auth_token !== "undefined" ? __initial_auth_token : null;

      try {
        if (token) {
          try {
            await signInWithCustomToken(auth, token);
          } catch (e) {
            await signInAnonymously(auth);
          }
        } else {
          await signInAnonymously(auth);
        }

        onAuthStateChanged(auth, (user) => {
          if (user) window.listenToLeaderboard();
        });
      } catch (e) {
        console.error(e);
      }
    }

    function createLoginStars() {
      const bg = document.getElementById("login-space-bg");
      if (!bg) return;

      for (let i = 0; i < 80; i++) {
        const star = document.createElement("div");
        const size = Math.random() * 2 + 1;
        star.style.position = "absolute";
        star.style.width = size + "px";
        star.style.height = size + "px";
        star.style.background = "white";
        star.style.borderRadius = "50%";
        star.style.left = Math.random() * 100 + "%";
        star.style.top = Math.random() * 100 + "%";
        star.style.opacity = Math.random();
        star.style.boxShadow = `0 0 ${size * 2}px white`;
        star.animate([{ opacity: 0.2 }, { opacity: 1 }, { opacity: 0.2 }], {
          duration: 2000 + Math.random() * 3000,
          iterations: Infinity
        });
        bg.appendChild(star);
      }
    }

    function init() {
      initFirebaseLocal();
      createLoginStars();

      const container = document.getElementById("game-container");
      for (let i = 0; i < 60; i++) {
        stars.push({ x: Math.random() * GAME_WIDTH, y: Math.random() * GAME_HEIGHT, size: Math.random() * 1.5 });
      }

      engine = Matter.Engine.create();
      engine.world.gravity.y = 1.2;

      render = Matter.Render.create({
        element: container,
        engine: engine,
        options: { width: GAME_WIDTH, height: GAME_HEIGHT, wireframes: false, background: "transparent" }
      });

      const wallOptions = { isStatic: true, friction: 0.8, restitution: 0.2 };

      Matter.World.add(engine.world, [
        Matter.Bodies.rectangle(GAME_WIDTH / 2, GAME_HEIGHT + 15, GAME_WIDTH, 30, wallOptions), // bottom
        Matter.Bodies.rectangle(-15, GAME_HEIGHT / 2, 30, GAME_HEIGHT, wallOptions), // left
        Matter.Bodies.rectangle(GAME_WIDTH + 15, GAME_HEIGHT / 2, 30, GAME_HEIGHT, wallOptions), // right
        Matter.Bodies.rectangle(GAME_WIDTH / 2, -15, GAME_WIDTH, 30, wallOptions) // top (ceiling)
      ]);

      Matter.Render.run(render);
      runner = Matter.Runner.create();
      Matter.Runner.run(runner, engine);

      Matter.Events.on(render, "afterRender", () => {
        const ctx = render.context;
        ctx.fillStyle = "white";

        stars.forEach((s) => {
          ctx.globalAlpha = 0.2 + Math.abs(Math.sin(Date.now() * 0.001 + s.x)) * 0.5;
          ctx.beginPath();
          ctx.arc(s.x, s.y, s.size, 0, Math.PI * 2);
          ctx.fill();
        });

        ctx.globalAlpha = 1;

        Matter.Composite.allBodies(engine.world).forEach((body) => {
          if (body.label?.startsWith("planet_")) {
            const index = parseInt(body.label.split("_")[1], 10);
            drawPlanet(ctx, body.position.x, body.position.y, body.angle, PLANETS[index]);
          }
        });

        if (currentPlanet && !isGameOver) {
          drawPlanet(ctx, currentPlanet.x, currentPlanet.y, 0, PLANETS[currentPlanet.index], 0.7);
        }
      });

      Matter.Events.on(engine, "collisionStart", (event) => {
        event.pairs.forEach((pair) => {
          const { bodyA, bodyB } = pair;
          if (bodyA.label === bodyB.label && bodyA.label?.startsWith("planet_")) {
            const index = parseInt(bodyA.label.split("_")[1], 10);
            if (index < PLANETS.length - 1) {
              if (Matter.Composite.get(engine.world, bodyA.id, "body") && Matter.Composite.get(engine.world, bodyB.id, "body")) {
                mergePlanets(bodyA, bodyB, index);
              }
            }
          }
        });
      });

      setInterval(checkGameOver, 250);
      setupNextPlanet();
    }

    function drawPlanet(ctx, x, y, angle, type, opacity = 1) {
      ctx.save();
      ctx.translate(x, y);
      ctx.rotate(angle);
      ctx.globalAlpha = opacity;

      ctx.shadowBlur = type.radius * 0.4;
      ctx.shadowColor = type.color;

      ctx.fillStyle = type.color;
      ctx.beginPath();
      ctx.arc(0, 0, type.radius, 0, Math.PI * 2);
      ctx.fill();
      ctx.shadowBlur = 0;

      ctx.save();
      ctx.clip();

      if (type.detail === "crater") {
        ctx.fillStyle = "rgba(0,0,0,0.1)";
        ctx.beginPath(); ctx.arc(-type.radius * 0.3, -type.radius * 0.2, type.radius * 0.2, 0, 7); ctx.fill();
        ctx.beginPath(); ctx.arc(type.radius * 0.4, type.radius * 0.3, type.radius * 0.15, 0, 7); ctx.fill();
        ctx.beginPath(); ctx.arc(0, type.radius * 0.5, type.radius * 0.1, 0, 7); ctx.fill();
      } else if (type.detail === "earth") {
        ctx.fillStyle = "#44aa44";
        ctx.beginPath(); ctx.ellipse(-5, -5, type.radius * 0.7, type.radius * 0.4, 0.5, 0, 7); ctx.fill();
        ctx.beginPath(); ctx.ellipse(10, 10, type.radius * 0.5, type.radius * 0.6, -0.2, 0, 7); ctx.fill();
        ctx.beginPath(); ctx.ellipse(-15, 20, type.radius * 0.3, type.radius * 0.2, 0, 0, 7); ctx.fill();
      } else if (type.detail === "jupiter" || type.detail === "clouds" || type.detail === "storm") {
        ctx.strokeStyle = "rgba(0,0,0,0.1)";
        ctx.lineWidth = type.radius * 0.15;
        for (let i = -3; i <= 3; i++) {
          ctx.beginPath();
          ctx.moveTo(-type.radius, i * type.radius * 0.25);
          ctx.lineTo(type.radius, i * type.radius * 0.25);
          ctx.stroke();
        }
        if (type.detail === "jupiter" || type.detail === "storm") {
          ctx.fillStyle = "rgba(0,0,0,0.15)";
          ctx.beginPath();
          ctx.arc(type.radius * 0.4, type.radius * 0.3, type.radius * 0.2, 0, 7);
          ctx.fill();
        }
      }

      ctx.restore();

      const eyeSize = Math.max(1.5, type.radius * 0.1);
      const eyeSpace = type.radius * 0.3;
      const faceY = -type.radius * 0.05;

      ctx.fillStyle = "#222";
      ctx.strokeStyle = "#222";
      ctx.lineWidth = Math.max(1, type.radius * 0.06);
      ctx.lineCap = "round";

      switch (type.personality) {
        case "sleeping":
          ctx.beginPath(); ctx.arc(-eyeSpace, faceY, eyeSize, Math.PI, 0); ctx.stroke();
          ctx.beginPath(); ctx.arc(eyeSpace, faceY, eyeSize, Math.PI, 0); ctx.stroke();
          ctx.beginPath(); ctx.arc(0, faceY + eyeSize, eyeSize * 0.5, 0, Math.PI * 2); ctx.fill();
          break;
        case "shy":
          ctx.beginPath(); ctx.arc(-eyeSpace, faceY, eyeSize, 0, Math.PI * 2); ctx.fill();
          ctx.beginPath(); ctx.arc(eyeSpace, faceY, eyeSize, 0, Math.PI * 2); ctx.fill();
          ctx.fillStyle = "rgba(255, 100, 100, 0.4)";
          ctx.beginPath(); ctx.ellipse(-eyeSpace - eyeSize, faceY + eyeSize, eyeSize, eyeSize * 0.5, 0, 0, 7); ctx.fill();
          ctx.beginPath(); ctx.ellipse(eyeSpace + eyeSize, faceY + eyeSize, eyeSize, eyeSize * 0.5, 0, 0, 7); ctx.fill();
          ctx.beginPath(); ctx.arc(0, faceY + eyeSize, eyeSize * 0.5, 0, Math.PI); ctx.stroke();
          break;
        case "angry":
          ctx.beginPath(); ctx.moveTo(-eyeSpace - eyeSize, faceY - eyeSize); ctx.lineTo(-eyeSpace + eyeSize, faceY); ctx.stroke();
          ctx.beginPath(); ctx.moveTo(eyeSpace + eyeSize, faceY - eyeSize); ctx.lineTo(eyeSpace - eyeSize, faceY); ctx.stroke();
          ctx.fillStyle = "#222";
          ctx.beginPath(); ctx.arc(-eyeSpace, faceY + eyeSize * 0.6, eyeSize, 0, 7); ctx.fill();
          ctx.beginPath(); ctx.arc(eyeSpace, faceY + eyeSize * 0.6, eyeSize, 0, 7); ctx.fill();
          ctx.beginPath(); ctx.arc(0, faceY + eyeSize * 1.8, eyeSize * 0.8, Math.PI, 0); ctx.stroke();
          break;
        case "happy":
          ctx.beginPath(); ctx.arc(-eyeSpace, faceY, eyeSize, 0, Math.PI * 2); ctx.fill();
          ctx.beginPath(); ctx.arc(eyeSpace, faceY, eyeSize, 0, Math.PI * 2); ctx.fill();
          ctx.beginPath(); ctx.arc(0, faceY + eyeSize, eyeSpace * 0.6, 0.2, Math.PI - 0.2); ctx.stroke();
          break;
        case "cool":
          ctx.fillStyle = "#222";
          ctx.beginPath(); ctx.arc(-eyeSpace, faceY, eyeSize * 1.4, 0, Math.PI * 2); ctx.fill();
          ctx.beginPath(); ctx.arc(eyeSpace, faceY, eyeSize * 1.4, 0, Math.PI * 2); ctx.fill();
          ctx.beginPath(); ctx.fillRect(-eyeSpace - eyeSize, faceY - eyeSize * 1.5, eyeSpace * 2 + eyeSize * 2, eyeSize * 0.4); ctx.fill();
          ctx.beginPath(); ctx.arc(0, faceY + eyeSize, eyeSize * 0.7, 0, Math.PI); ctx.stroke();
          break;
        case "dizzy":
          ctx.beginPath(); ctx.arc(-eyeSpace, faceY, eyeSize, 0, Math.PI * 2); ctx.stroke();
          ctx.beginPath(); ctx.arc(eyeSpace, faceY, eyeSize, 0, Math.PI * 2); ctx.stroke();
          ctx.beginPath(); ctx.moveTo(-eyeSize * 0.5, faceY + eyeSize * 1.5); ctx.lineTo(eyeSize * 0.5, faceY + eyeSize * 2); ctx.lineTo(-eyeSize * 0.5, faceY + eyeSize * 2.5); ctx.stroke();
          break;
        case "nerd":
          ctx.beginPath(); ctx.arc(-eyeSpace, faceY, eyeSize * 1.6, 0, Math.PI * 2); ctx.stroke();
          ctx.beginPath(); ctx.arc(eyeSpace, faceY, eyeSize * 1.6, 0, Math.PI * 2); ctx.stroke();
          ctx.beginPath(); ctx.moveTo(-eyeSpace + eyeSize * 1.6, faceY); ctx.lineTo(eyeSpace - eyeSize * 1.6, faceY); ctx.stroke();
          ctx.beginPath(); ctx.arc(-eyeSpace, faceY, eyeSize * 0.5, 0, Math.PI * 2); ctx.fill();
          ctx.beginPath(); ctx.arc(eyeSpace, faceY, eyeSize * 0.5, 0, Math.PI * 2); ctx.fill();
          ctx.beginPath(); ctx.arc(0, faceY + eyeSize, eyeSize * 0.7, 0.4, Math.PI - 0.4); ctx.stroke();
          break;
        case "fancy":
          ctx.beginPath(); ctx.arc(-eyeSpace, faceY, eyeSize, 0, Math.PI * 2); ctx.fill();
          ctx.beginPath(); ctx.arc(eyeSpace, faceY, eyeSize, 0, Math.PI * 2); ctx.fill();
          ctx.beginPath(); ctx.moveTo(-eyeSpace - eyeSize, faceY - eyeSize); ctx.lineTo(-eyeSpace - eyeSize * 1.5, faceY - eyeSize * 1.5); ctx.stroke();
          ctx.beginPath(); ctx.moveTo(eyeSpace + eyeSize, faceY - eyeSize); ctx.lineTo(eyeSpace + eyeSize * 1.5, faceY - eyeSize * 1.5); ctx.stroke();
          ctx.beginPath(); ctx.arc(0, faceY + eyeSize * 0.8, eyeSpace * 0.5, 0, Math.PI); ctx.stroke();
          break;
        case "king":
          ctx.beginPath(); ctx.arc(-eyeSpace, faceY, eyeSize * 1.2, 0, Math.PI * 2); ctx.fill();
          ctx.beginPath(); ctx.arc(eyeSpace, faceY, eyeSize * 1.2, 0, Math.PI * 2); ctx.fill();
          ctx.beginPath(); ctx.arc(0, faceY + eyeSize, eyeSpace * 0.5, 0, Math.PI); ctx.stroke();
          ctx.fillStyle = "#ffcc33";
          ctx.beginPath();
          ctx.moveTo(-eyeSize * 2, faceY - type.radius * 0.6);
          ctx.lineTo(-eyeSize, faceY - type.radius * 0.4);
          ctx.lineTo(0, faceY - type.radius * 0.6);
          ctx.lineTo(eyeSize, faceY - type.radius * 0.4);
          ctx.lineTo(eyeSize * 2, faceY - type.radius * 0.6);
          ctx.lineTo(eyeSize * 2, faceY - type.radius * 0.3);
          ctx.lineTo(-eyeSize * 2, faceY - type.radius * 0.3);
          ctx.fill();
          break;
        case "sun":
          ctx.beginPath(); ctx.arc(-eyeSpace, faceY, eyeSize * 1.3, 0, Math.PI * 2); ctx.fill();
          ctx.beginPath(); ctx.arc(eyeSpace, faceY, eyeSize * 1.3, 0, Math.PI * 2); ctx.fill();
          ctx.fillStyle = "#ff6666";
          ctx.beginPath(); ctx.arc(-eyeSpace - eyeSize * 1.5, faceY + eyeSize, eyeSize * 1.2, 0, Math.PI * 2); ctx.fill();
          ctx.beginPath(); ctx.arc(eyeSpace + eyeSize * 1.5, faceY + eyeSize, eyeSize * 1.2, 0, Math.PI * 2); ctx.fill();
          ctx.beginPath(); ctx.arc(0, faceY + eyeSize, eyeSpace * 0.7, 0, Math.PI); ctx.stroke();
          break;
        default:
          ctx.beginPath(); ctx.arc(-eyeSpace, faceY, eyeSize, 0, Math.PI * 2); ctx.fill();
          ctx.beginPath(); ctx.arc(eyeSpace, faceY, eyeSize, 0, Math.PI * 2); ctx.fill();
          ctx.beginPath(); ctx.arc(0, faceY + eyeSize, eyeSpace * 0.6, 0.2, Math.PI - 0.2); ctx.stroke();
      }

      ctx.restore();

      if (type.detail.includes("ring")) {
        ctx.save();
        ctx.translate(x, y);
        if (type.detail === "ring_vertical") ctx.rotate(Math.PI / 2);
        ctx.strokeStyle = "rgba(255,255,255,0.4)";
        ctx.lineWidth = type.radius * 0.08;
        ctx.beginPath();
        ctx.ellipse(0, 0, type.radius * 1.6, type.radius * 0.35, 0, 0, Math.PI * 2);
        ctx.stroke();
        ctx.restore();
      }
    }

    function setupNextPlanet() {
      nextPlanetIndex = Math.floor(Math.random() * 4);
      const nextCanvas = document.getElementById("next-canvas");
      const nextCtx = nextCanvas.getContext("2d");
      nextCtx.clearRect(0, 0, 100, 100);

      const type = PLANETS[nextPlanetIndex];
      const scale = 40 / Math.max(type.radius, 40);

      nextCtx.save();
      nextCtx.translate(50, 50);
      nextCtx.scale(scale, scale);
      drawPlanet(nextCtx, 0, 0, 0, type);
      nextCtx.restore();
    }

    function spawnPlanet() {
      if (isGameOver) return;

      const radius = PLANETS[nextPlanetIndex].radius;
      const clampedX = Math.max(radius, Math.min(GAME_WIDTH - radius, lastMouseX));

      currentPlanet = { index: nextPlanetIndex, x: clampedX, y: 50 };
      document.getElementById("current-planet-name").innerText = PLANETS[nextPlanetIndex].name;
      document.getElementById("guide").style.left = clampedX + "px";

      setupNextPlanet();
    }

    function dropPlanet() {
      if (!currentPlanet || !canDrop || isGameOver) return;

      playSfx("sfx-drop", 0.6);

      const newBody = Matter.Bodies.circle(
        currentPlanet.x,
        currentPlanet.y,
        PLANETS[currentPlanet.index].radius,
        {
          label: `planet_${currentPlanet.index}`,
          restitution: 0.1,
          friction: 0.8,
          frictionAir: 0.02,
          render: { visible: false }
        }
      );

      Matter.World.add(engine.world, newBody);

      currentPlanet = null;
      canDrop = false;

      setTimeout(() => {
        canDrop = true;
        spawnPlanet();
      }, 800);
    }

    function mergePlanets(bodyA, bodyB, index) {
      const avgVel = {
        x: (bodyA.velocity.x + bodyB.velocity.x) / 2,
        y: (bodyA.velocity.y + bodyB.velocity.y) / 2
      };

      const x = (bodyA.position.x + bodyB.position.x) / 2;
      const y = (bodyA.position.y + bodyB.position.y) / 2;

      Matter.World.remove(engine.world, [bodyA, bodyB]);

      const nextIdx = index + 1;
      const nextPlanetBody = Matter.Bodies.circle(x, y, PLANETS[nextIdx].radius, {
        label: `planet_${nextIdx}`,
        restitution: 0.2,
        friction: 0.6,
        render: { visible: false }
      });

      Matter.Body.setVelocity(nextPlanetBody, avgVel);
      Matter.World.add(engine.world, nextPlanetBody);

      playSfx("sfx-merge", 0.25);

      score += PLANETS[nextIdx].score;
      document.getElementById("score").innerText = score;

      document.getElementById("game-container").style.boxShadow = `0 0 70px ${PLANETS[nextIdx].color}44`;
      setTimeout(() => {
        document.getElementById("game-container").style.boxShadow = "0 0 50px rgba(0, 100, 255, 0.2)";
      }, 400);
    }

    function checkGameOver() {
      if (isGameOver) return;
      if (document.getElementById("ui-layer").style.opacity !== "1") return;

      Matter.Composite.allBodies(engine.world).forEach((body) => {
        if (!body.label?.startsWith("planet_")) return;

        const r = body.circleRadius || 0;

        // ‡∏´‡∏•‡∏∏‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏•‡∏π‡∏Å‡∏≠‡∏≠‡∏Å‡∏ô‡∏≠‡∏Å‡∏à‡∏≠
        if (body.position.y + r < 0) {
          triggerGameOver();
          return;
        }

        // ‡∏•‡πâ‡∏ô‡πÇ‡∏ã‡∏ô‡∏ö‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏¥‡πà‡∏á‡πÄ‡∏Å‡∏¥‡∏ô 2 ‡∏ß‡∏¥
        if (body.position.y < 110 && Math.abs(body.velocity.y) < 0.1) {
          if (!body.gameOverTimer) body.gameOverTimer = Date.now();
          if (Date.now() - body.gameOverTimer > 2000) {
            triggerGameOver();
          }
        } else {
          body.gameOverTimer = null;
        }
      });
    }

    function triggerGameOver() {
      if (isGameOver) return;

      playSfx("sfx-gameover", 0.9);
      stopBgm();

      isGameOver = true;
      isAiming = false;
      hideStarCursor();

      document.getElementById("ui-layer").style.opacity = "0";
      document.getElementById("guide").style.display = "none";
      document.getElementById("surrender-btn").style.display = "none";
      document.getElementById("mute-btn").style.display = "none";
      document.getElementById("current-planet-name").style.display = "none";

      document.getElementById("game-over").style.display = "flex";
      document.getElementById("final-score").innerText = score;
      document.getElementById("display-my-name").innerText = playerName;

      window.saveScoreToCloud(score, playerName);
    }

    document.getElementById("start-btn").onclick = () => {
      const input = document.getElementById("player-name-input");
      if (!input.value.trim()) {
        input.style.borderColor = "#ff5555";
        input.style.boxShadow = "0 0 15px rgba(255,85,85,0.3)";
        return;
      }

      playerName = input.value.trim();

      document.getElementById("login-screen")
        .animate([{ opacity: 1, transform: "scale(1)" }, { opacity: 0, transform: "scale(1.1)" }], { duration: 500, fill: "forwards" })
        .onfinish = () => {
          document.getElementById("login-screen").style.display = "none";
          document.getElementById("ui-layer").style.opacity = "1";
          document.getElementById("guide").style.display = "block";
          document.getElementById("surrender-btn").style.display = "flex";
          document.getElementById("mute-btn").style.display = "flex";

          startBgm(0.35);
          showStarCursor();

          spawnPlanet();
        };
    };

    document.getElementById("mute-btn").onclick = () => {
      setMute(!isMuted);
    };

    // ===========================
    // ‚úÖ Input: Mouse + Touch Aim
    // ===========================
    const containerElem = document.getElementById("game-container");

    function canInteractNow(){
      if (isGameOver) return false;
      if (document.getElementById("ui-layer").style.opacity !== "1") return false;
      if (!currentPlanet || !canDrop) return false;
      return true;
    }

    function getClientXY(e){
      if (e.touches && e.touches.length) {
        return { x: e.touches[0].clientX, y: e.touches[0].clientY };
      }
      if (e.changedTouches && e.changedTouches.length) {
        return { x: e.changedTouches[0].clientX, y: e.changedTouches[0].clientY };
      }
      return { x: e.clientX, y: e.clientY };
    }

    function updateCursorAndAim(e){
      const rect = containerElem.getBoundingClientRect();
      const { x: cx, y: cy } = getClientXY(e);

      lastMouseX = cx - rect.left;

      // star cursor
      targetX = cx - rect.left;
      targetY = cy - rect.top;
      if (!cursorRaf) cursorRaf = requestAnimationFrame(animateStarCursor);

      // move planet only while aiming
      if (!currentPlanet || isGameOver || !isAiming) return;

      const radius = PLANETS[currentPlanet.index].radius;
      const x = Math.max(radius, Math.min(GAME_WIDTH - radius, lastMouseX));
      currentPlanet.x = x;
      document.getElementById("guide").style.left = x + "px";
    }

    // ‡πÄ‡∏°‡∏≤‡∏™‡πå: ‡πÄ‡∏Ç‡πâ‡∏≤/‡∏≠‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏°
    containerElem.addEventListener("mouseenter", () => {
      if (!isGameOver && document.getElementById("ui-layer").style.opacity === "1") showStarCursor();
    });
    containerElem.addEventListener("mouseleave", () => {
      hideStarCursor();
      isAiming = false;
    });

    // Mouse
    containerElem.addEventListener("mousedown", (e) => {
      e.preventDefault();
      if (!canInteractNow()) return;
      isAiming = true;
      updateCursorAndAim(e);
    });

    containerElem.addEventListener("mousemove", (e) => {
      updateCursorAndAim(e);
    });

    containerElem.addEventListener("mouseup", (e) => {
      if (!isAiming) return;
      e.preventDefault();
      isAiming = false;
      dropPlanet();
    });

    // Touch (‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠) ‚Äî ‡∏ï‡πâ‡∏≠‡∏á passive:false ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ preventDefault ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
    containerElem.addEventListener("touchstart", (e) => {
      e.preventDefault();
      showStarCursor(); // ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ mouseenter
      if (!canInteractNow()) return;
      isAiming = true;
      updateCursorAndAim(e);
    }, { passive: false });

    containerElem.addEventListener("touchmove", (e) => {
      e.preventDefault();
      updateCursorAndAim(e);
    }, { passive: false });

    containerElem.addEventListener("touchend", (e) => {
      e.preventDefault();
      if (!isAiming) return;
      isAiming = false;
      dropPlanet();
    }, { passive: false });

    containerElem.addEventListener("touchcancel", (e) => {
      e.preventDefault();
      isAiming = false;
      hideStarCursor();
    }, { passive: false });

    // ‡∏Å‡∏±‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏ô‡∏≠‡∏Å‡∏Å‡∏£‡∏≠‡∏ö
    window.addEventListener("mouseup", () => {
      if (!isAiming) return;
      isAiming = false;
    });

    window.onload = init;
    window.triggerGameOver = triggerGameOver;
  </script>
</body>
</html>
